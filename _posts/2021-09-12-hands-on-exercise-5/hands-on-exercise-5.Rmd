---
title: "Hands-on-Exercise-5"
description: |
  A short description of the post.
author:
  - name: Wong Wei Ling
    url: www.google.com
date: 09-12-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```



# 1 Installing and launching the R packages

```{r echo=TRUE, eval=TRUE}
packages = c('sp', 'rgdal', 'spNetwork', 'tmap')

for (p in packages){
if(!require(p, character.only = T)){
  install.packages(p)
}
  library(p,character.only = T)
}
```

# 2 Data Import and Preparation

- readOGD() of rgdal package to import Punggol_St and Punggol_CC geospatial data sets as SpatialLinesDataFrame and SpatialPointsDataFrame respectively

```{r echo=TRUE, eval=TRUE}
network <- readOGR(dsn="data/geospatial", 
                   layer="Punggol_St",
                   verbose = FALSE)
childcare <- readOGR(dsn="data/geospatial",
                     layer="Punggol_CC",
                     verbose = FALSE)
```


- Print the content of network SpatialLineDataFrame and childcare SpatialPointsDataFrame

```{r echo=TRUE, eval=TRUE}
str(network)
str(childcare)
```

## Assign CRS

- To assign EPSG code to the SpatialDataFrames. The epsg:3414 is the code for svy21.

```{r echo=TRUE, eval=TRUE}
childcare <-spTransform(childcare, CRS("+init=epsg:3414"))
network <- spTransform(network,CRS("+init=epsg:3414"))
```


# 3 Visualising the Geospatial Data

- Good practice to visualise the geospatial data

```{r echo=TRUE, eval=TRUE}
plot(network)
plot(childcare,add=T,col='red',pch = 19)
```

- To visualise the geospatial data with high cartographic quality and interactive manner

```{r echo=TRUE, eval=TRUE}
tmap_mode('view')
tm_shape(childcare)+
  tm_dots() +
tm_shape(network)+
  tm_lines()
```

- Set back to plot mode

```{r echo=TRUE, eval=TRUE}
tmap_mode('plot')
```


# 4 Network Constrained KDE (NetKDE) Analysis

## 4.1 Preparing the lixels objects

- Before computing NetKDE, the SpatialLines object need to be cut into lixels with a specified minimal distance.

    + The length of a lixel, lx_length is set to 700m, and
    + The minimum length of a lixel, mindist is set to 350m.
    
- After cutting, if the length of the final lixel is shorter than the minimum distance, then it is added to the previous lixel.
- If NULL, then mindist = maxdist/10. Also note that the segments that are already shorter than the minimum distance are not modified

**Note**: There is another function called lixelize_lines.mc() which provide multicore support.

```{r echo=TRUE, eval=TRUE}
lixels <- lixelize_lines(network,700,mindist = 350)
```


## 4.2 Generating line centre points

- To generate a SpatialPointsDataFrame (i.e. samples) with line centre points

```{r echo=TRUE, eval=TRUE}
samples <- lines_center(lixels)

```

- The points are located at center of the line based on the length of the line.
