---
title: "Hands-on Exercise 9"
description: |
  Inhands-on exercise 9, I have learnt how to calibrate geographically weighted regression models by using GWmodel package of R.
author:
  - name: Wong Wei Ling
    url: www.google.com
date: 10-16-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```



# 1 Overview

Geographically weighted regression (GWR) is a spatial statistical technique that takes non-stationary variables into consideration (e.g., climate; demographic factors; physical environment characteristics) and models the local relationships between these independent variables and an outcome of interest (also known as dependent variable).

In this hands-on exercise, I have learnt to build hedonic pricing models by using GWR methods. The dependent variable is the resale prices of condominium in 2015. The independent variables are divided into either structural and locational.

# 2 Data

Two data sets will be used in this model building exercise, they are:

- URA Master Plan subzone boundary in shapefile format (i.e. MP14_SUBZONE_WEB_PL)
- condo_resale_2015 in csv format (i.e. condo_resale_2015.csv)

# 3 Import packages

-Geospatial statistical modelling package: **GWmodel**
-Spatial data handling: **sf**
-Attribute data handling: **tidyverse**, especially **read**r, **ggplot2** and **dplyr**
-Choropleth mapping: **tmap**


```{r echo=TRUE, eval=TRUE,  cache=TRUE}
packages = c('olsrr', 'corrplot', 'ggpubr', 'sf', 'spdep', 'GWmodel', 'tmap', 'tidyverse')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

**A short note about GWmodel**

GWmodel package provides a collection of localised spatial statistical methods, namely: GW summary statistics, GW principal components analysis, GW discriminant analysis and various forms of GW regression; some of which are provided in basic and robust (outlier resistant) forms. Commonly, outputs or parameters of the GWmodel are mapped to provide a useful exploratory tool, which can often precede (and direct) a more traditional or sophisticated statistical analysis.

# 4 Geospatial Data Wrangling

# 4.1 Import geospatial data

- Import *MP_SUBZONE_WEB_PL* shapefile by using *st_read()* of **sf** packages.

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
mpsz = st_read(dsn = "data/geospatial", layer = "MP14_SUBZONE_WEB_PL")

```

Results above show that:

- R object used to contain the imported MP14_SUBZONE_WEB_PL shapefile is called mpsz and it is a simple feature object.
- The geometry type is multipolygon. 
- It is also important to note that mpsz simple feature object does not have EPSG information.

# 4.2 Update CRS information

- Update the newly imported mpsz with the correct ESPG code (i.e. 3414)
- Verify  the newly transformed mpsz_svy21.

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
mpsz_svy21 <- st_transform(mpsz, 3414)
st_crs(mpsz_svy21)

```

# 4.3 reveal the extent of mpsz_svy21

- Use *st_bbox()* of **sf** package

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
st_bbox(mpsz_svy21)
```

# 5 Aspatial Data Wrangling

# 5.1 Import the aspatial data

-  Use *read_csv()* function of **readr** package to import condo_resale_2015 into R as a tibble data frame called condo_resale.
-  use *glimpse()* to display the data structure

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
condo_resale <- read_csv("data/aspatial/Condo_resale_2015.csv")
glimpse(condo_resale)

```

- See the data in XCOORD column

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
head(condo_resale$LONGITUDE) 

```

- See the data in YCOORD column

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
head(condo_resale$LATITUDE) 

```

- See summary statsitics of *condo_resale*

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
summary(condo_resale)

```

# 5.2 Convert aspatial data frame into a sf object

- Use *st_as_sf()* of sf packages.
- *st_transform()* of **sf** package is used to convert the coordinates from wgs84 (i.e. crs:4326) to svy21 (i.e. crs=3414).

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
condo_resale.sf <- st_as_sf(condo_resale,
                            coords = c("LONGITUDE", "LATITUDE"),
                            crs=4326) %>%
  st_transform(crs=3414)
head(condo_resale.sf)
```

# 6 Exploratory Data Analysis

## 6.1 EDA using statistical graphics

### 6.1.1 Plot distribution

- Plot the distribution of SELLING_PRICE by using appropriate Exploratory Data Analysis (EDA) 

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
ggplot(data=condo_resale.sf, aes(x=`SELLING_PRICE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
```

Results above show that: 

- Reveals a right skewed distribution. This means that more condominium units were transacted at relative lower prices.

### 6.1.2 Normalise using Log Transformation

- Statistically, the skewed distribution can be normalised by using log transformation. 
- Use to derive a new variable called **LOG_SELLING_PRICE** by using a log transformation on the variable SELLING_PRICE.
- It is performed using *mutate()* of **dplyr** package.

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
condo_resale.sf <- condo_resale.sf %>%
  mutate(`LOG_SELLING_PRICE` = log(SELLING_PRICE))
```

### 6.1.3 Plot **LOG_SELLING_PRICE** 

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
ggplot(data=condo_resale.sf, aes(x=`LOG_SELLING_PRICE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
```

Notice that the distribution is relatively **less skewed after the transformation**.

## 6.2 Multiple Histogram Plots distribution of variables

- The code chunk below is used to create 12 histograms.
- *ggarrnage()* of **ggpubr** package is used to organised these histogram into a 3 columns by 4 rows small multiple plot.

```{r echo=TRUE, eval=TRUE,  cache=TRUE}
AREA_SQM <- ggplot(data=condo_resale.sf, aes(x= `AREA_SQM`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
AGE <- ggplot(data=condo_resale.sf, aes(x= `AGE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")  
PROX_CBD <- ggplot(data=condo_resale.sf, aes(x= `PROX_CBD`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_CHILDCARE <- ggplot(data=condo_resale.sf, aes(x= `PROX_CHILDCARE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_ELDERLYCARE <- ggplot(data=condo_resale.sf, aes(x= `PROX_ELDERLYCARE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_URA_GROWTH_AREA <- ggplot(data=condo_resale.sf, aes(x= `PROX_URA_GROWTH_AREA`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_HAWKER_MARKET <- ggplot(data=condo_resale.sf, aes(x= `PROX_HAWKER_MARKET`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_KINDERGARTEN <- ggplot(data=condo_resale.sf, aes(x= `PROX_KINDERGARTEN`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_MRT <- ggplot(data=condo_resale.sf, aes(x= `PROX_MRT`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_PARK <- ggplot(data=condo_resale.sf, aes(x= `PROX_PARK`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_PRIMARY_SCH <- ggplot(data=condo_resale.sf, aes(x= `PROX_PRIMARY_SCH`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
PROX_TOP_PRIMARY_SCH <- ggplot(data=condo_resale.sf, aes(x= `PROX_TOP_PRIMARY_SCH`)) +
  geom_histogram(bins=20, color="black", fill="light blue")

ggarrange(AREA_SQM, AGE, PROX_CBD, PROX_CHILDCARE, PROX_ELDERLYCARE, PROX_URA_GROWTH_AREA, PROX_HAWKER_MARKET, PROX_KINDERGARTEN, PROX_MRT, PROX_PARK, PROX_PRIMARY_SCH, PROX_TOP_PRIMARY_SCH,  ncol = 3, nrow = 4)
```

## 6.3 Drawing Statistical Point Map

-  Reveal the geospatial distribution condominium resale prices in Singapore. The map will be prepared by using tmap package.
- *tmap_mode("plot")* to use the interactive mode of tmap
- Then, create an interactive point symbol map

- *tm_dots()* is used instead of *tm_bubbles()*

    + set.zoom.limits argument of tm_view() sets the minimum and maximum zoom level to 11 and 14 respectively.
    
- Lastly, *tmap_mode("plot")* to display plot mode


```{r echo=TRUE, eval=TRUE,  cache=TRUE}
tmap_mode("plot")

tm_shape(mpsz_svy21)+
  tm_polygons() +
tm_shape(condo_resale.sf) +  
  tm_dots(col = "SELLING_PRICE",
          alpha = 0.6,
          style="quantile") +
  tm_view(set.zoom.limits = c(11,14))

tmap_mode("plot")
```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```

```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```

```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```

```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```


```{r echo=TRUE, eval=TRUE,  cache=TRUE}

```
